---
title: 常用Git命令速查
date: "2021-05-14T22:34:03.284Z"
description: "常用Git命令速查"
---

#####  撤销当前分支的变化

如果在某个分支上修改了代码并做了几次提交，结果突然发现放错了分支，这几个提交本应该放到另一个分支的时候。应该进行如下处理：

```shell
# 从当前分支的最新的提交新建出一个分支（注意，这时依然停留在当前分支）
$ git branch <branch_name>

# 切换到这几次提交之前的状态
$ git reset --hard <当前分支此前的最后一次提交Commit_ID]>

# 切换到第1步创建出来的分支
$ git checkout <branch_name>

# 后续可以在这个分支上继续进行开发，或者是将其merge到正确的分支后在正确的分支上进行开发。
```



##### 撤消暂存区文件

如果已经把文档加到了暂存区（通过`git add`命令)，但是还没有提交。如果想反悔可以进行如下处理：

```shell
# 用rm命令，适合单个文件，或文件不多的时候
$ git rm --cached <filename>

# 用reset HEAD命令也行，会恢复到最后一次commit时的状态
$ git reset HEAD
```

以上两个都可以，区别是`rm`需要一个一个文件的撤消，`reset HEAD`命令可以一直性全部撤消



##### 丢弃工作区文件的修改

如果发现代码改的不对，需要丢弃掉并且重头开始修改。可以进行如下处理：

```shell
# 这样做的原理是先找暂存区，如果该文件有暂存的版本，则恢复该版本，否则就恢复上一次提交的版本。
$ git checkout -- <filename>
```

*重要：工作区的文件变化一旦被撤销，就无法找回了。*



##### 丢弃提交（reset)

如果希望以前的提交在历史中彻底消失，可以使用`git reset`命令，丢弃掉某一次提交之后的所有提交。

```shell
# 丢弃掉commit之后所有的提交，如果不加--hard参数，工作区不会丢弃，加了这个参数工作区也丢弃了
$ git reset <commit_id> --hard

# 如果需要同步到远程，因为reset之后肯定是比远程落后的，所以要加上-f参数强制推送上去
$ git push -f <origin> <branch_name>

# 如果之前没有推送到远程，可以不用加-f参数
```

*重要：这个操作是很危险的，慎用*



##### 撤消提交(revert)

和丢弃提交的区别就是，撤消不会丢失历史，而是会产生一个新的commit去把之前某个commit的内容全部抵消掉。它不会改变过去的历史，所以是首选方式，没有任何丢失代码的风险。

`git revert` 命令只能抵消上一个提交，如果想抵消多个提交，必须在命令行依次指定提交。

```shell
$ git revert <commit_id1> <commit_id2> 
```

`git revert`命令还有两个参数。

> - `--no-edit`：执行时不打开默认编辑器，直接使用 Git 自动生成的提交信息。
> - `--no-commit`：只抵消暂存区和工作区的文件变化，不产生新的提交。



##### 替换上一次提交

提交以后，发现提交信息写错了，这时可以使用`git commit`命令的`--amend`参数修改上一次的提交信息。

 ```bash
 $ git commit --amend -m "Fixes bug #42"
 ```

它的原理是产生一个新的提交对象，替换掉上一次提交产生的提交对象。

这时如果暂存区有发生变化的文件，会一起提交到仓库。所以，`--amend`不仅可以修改提交信息，还可以整个把上一次提交替换掉。

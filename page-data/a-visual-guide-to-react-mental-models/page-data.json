{"componentChunkName":"component---src-templates-blog-post-js","path":"/a-visual-guide-to-react-mental-models/","result":{"data":{"site":{"siteMetadata":{"title":"Deathdealer's Blog"}},"markdownRemark":{"id":"5b4bc664-a3ac-5b80-bef8-d07e3c4f74d0","excerpt":"掌握一门语言、框架或工具的人和没有掌握的人之间最大的区别在于他们有没有清晰的心智模型。通过良好的心智模型，你可以直观地理解复杂问题并提出解决方案，而不是一步一步的去寻找答案。 无论你是React的老司机还是新手，拥有一个良好的心智模型是让你成为React…","html":"<p>掌握一门语言、框架或工具的人和没有掌握的人之间最大的区别在于他们有没有清晰的心智模型。通过良好的心智模型，你可以直观地理解复杂问题并提出解决方案，而不是一步一步的去寻找答案。</p>\n<blockquote>\n<p>无论你是React的老司机还是新手，拥有一个良好的心智模型是让你成为React老司机最快的方法。</p>\n</blockquote>\n<p>本文将解释那些帮助我解决问题和降低复杂性的心智模型：</p>\n<ul>\n<li>This is the first part of a <strong>three part</strong> series.</li>\n<li>Read the <a href=\"https://obedparla.com/code/a-visual-guide-to-react-mental-models-part-2-use-state-use-effect-and-lifecycles/\">second part here, covering <code class=\"language-text\">useState</code>,<code class=\"language-text\">useEffect</code> and a component’s lifecycles</a>.</li>\n</ul>\n<h2>什么是心智模型?</h2>\n<p>心智模型是我们想象一个系统如何工作的方式。 我们通过理解系统的不同部分及其联系来构建心智模型，它很重要，因为它帮助我们理解世界，帮助我们解决问题。</p>\n<img src=\"https://obs-1d2f.oss-cn-hangzhou.aliyuncs.com/images/image-20210525180948977.png\" alt=\"image-20210525180948977\" style=\"zoom:45%;\">\n<p>A good example of a mental model is the internet: it’s a complex system with many interconnected parts, but think about the way you imagine it to work. I imagine it as many computers connected through many big servers, with many middlemen redirecting where each piece of information is stored.</p>\n<p>That’s an incomplete mental model but it’s good enough that I can work with it to solve problems and improve it if I ever need to, and that’s the gist of it: Mental models are meant to help us solve problems and understand the world.</p>\n<h2>Why Are Mental Models Important?</h2>\n<p>When I started building websites in 2014 I had a hard time understanding how it all worked. Building my blog with WordPress was easy, but I had no idea about hosting, servers, DNS, certificates, and much more.</p>\n<p>As I read articles and tried stuff out (and broke my server config more than once) I started to grasp the system, to get glimpses into how it all worked, until eventually it “clicked” and I felt comfortable working with it. My mind had built a mental model around this system that I could use to work with it.</p>\n<p>If someone had explained it by transferred their mental model to me, I would’ve understood it much faster. Here I’ll explain (and show) the mental models I use with React. It will help you understand React better and make you a better developer.</p>\n<h2>React Mental Models</h2>\n<p>React helps us build complex, interactive UIs more easily than ever before. It also encourages us to write code in a certain way, guiding us to create apps that are simpler to navigate and understand.</p>\n<img src=\"https://obs-1d2f.oss-cn-hangzhou.aliyuncs.com/images/image-20210528170005430.png\" alt=\"image-20210528170005430\" style=\"zoom:45%;\">\n<p>React itself is a mental model with a simple idea at its core: encapsulate portions of your app that rely on similar logic and UI and React will make sure that portion is always up kept up to date.</p>\n<p>Whether you’ve been working with React for years or are just starting, having a clear mental model is the best way to feel confident working with it. So for me to transfer my mental models to you I’ll start from first-principles and build on top of them.</p>\n<h2>It’s Functions All The Way Down</h2>\n<p>Let’s start by modeling the basic building blocks of JavaScript and React: functions.</p>\n<ul>\n<li>A React component is just a function</li>\n<li>Components containing other components are functions calling other functions</li>\n<li>Props are the function’s arguments</li>\n</ul>\n<p>This is hidden away by JSX, the markup language React uses. Strip away JSX and React is a bunch of functions calling one another. JSX is in itself an applied mental model that makes using React simpler and more intuitive.</p>\n<p>Let’s look at each part individually.</p>\n<h3>A Component Is A Function That Returns JSX</h3>\n<p>React is used with JSX—JavaScript XML—a way to write what seems as HTML with all of JavaScript’s power. JSX offers a great applied mental model for using nested functions in a way that feels intuitive.</p>\n<p>Let’s ignore class components and focus on the far more common functional components. A <em>functional</em> component is a function that behaves exactly like any other JavaScript function. React components always return JSX which is then executed and turned into HTML.</p>\n<p>This is what simple JSX looks like:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Li</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">...</span><span class=\"token attr-value\">props</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">RickRoll</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>wrapper<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Li</span></span> <span class=\"token attr-name\">color</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'red'</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Never give you up</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Li</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Which compiled into pure JavaScript by Babel:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Li</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'li'</span><span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">RickRoll</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  React<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'div'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    React<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">'div'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        className<span class=\"token operator\">:</span> <span class=\"token string\">'wrapper'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      React<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'ul'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n        React<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>\n          Li<span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n            color<span class=\"token operator\">:</span> <span class=\"token string\">'red'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'Never give you up'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>If you find this code difficult to follow you’re not alone, and you will understand why the React team decided to use JSX instead.</p>\n<p>Now, notice how each component is a function calling another function, and each new component is the third argument for the <code class=\"language-text\">React.createElement</code> function. Whenever you write a component, it’s useful to keep in mind that it’s a normal JavaScript function.</p>\n<p>An important feature of React is that a component can have many children but only one parent. I found this a confusing until I realized it’s the same logic HTML has, where each element must be inside other elements, and can have many children. You can notice this in the code above, where there’s only one parent <code class=\"language-text\">div</code> containing all the children.</p>\n<h3>Component’s Props Are The Same As A Function’s Arguments</h3>\n<p>When using a function we can use arguments to share information with that function. For React components we call these arguments <code class=\"language-text\">props</code> (funny story, I didn’t realize props is short for <em>properties</em> for a long time).</p>\n<p>Under the hood, props behave <em>exactly</em> like function arguments, the differences are that we interact with them through the nicer interface of JSX, and that React gives extra functionality to props such as <code class=\"language-text\">children</code>.</p>\n<h2>Creating A Mental Model Around Functions</h2>\n<p>Using this knowledge let’s craft a mental model to intuitively understand functions!</p>\n<p>When I think about a function I imagine it as a box, and that box will do something whenever it’s called. It could return a value or not:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 30</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">logSum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 30</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Since a component is a fancy function, that makes a component a box as well, with <code class=\"language-text\">props</code> as the ingredients the box needs to create the output.</p>\n<img src=\"https://obs-1d2f.oss-cn-hangzhou.aliyuncs.com/images/image-20210528170114384.png\" alt=\"image-20210528170114384\" style=\"zoom:45%;\">\n<p>When a component is executed it will run whatever logic it has, if any, and evaluate its JSX. Any tags will become HTML and any component will be executed, and the process is repeated until reaching the last component in the chain of children.</p>\n<p>Since a component can have many children but only one parent I imagine multiple components as a set of boxes, one inside another. Each box must be contained within a bigger box and can have many smaller boxes inside.</p>\n<p><a href=\"https://obedparla.com/static/cf7892f6a3db2815d6c502fe74538e4a/1df45/box-inside-box.jpg\"><img src=\"https://obedparla.com/static/cf7892f6a3db2815d6c502fe74538e4a/1df45/box-inside-box.jpg\" alt=\"One big box with many smaller boxes inside and text saying &#x22;it&#x27;s a box in another box&#x22;\"></a></p>\n<p>But the mental model of a box representing a component is not complete without understanding how it can interact with other boxes.</p>\n<h2>How To Think About Closures</h2>\n<p>Closures are a core concept in JavaScript. They enable complex functionality in the language, they’re super important to understand to have a good mental model around React.</p>\n<p>They’re also one of the features newcomers struggle with the most, so instead of explaining the technicalities I’ll demonstrate the mental model I have around closures.</p>\n<p>The basic description of a closure is that it’s a function. I imagine it as a box that keeps what’s inside of it from spilling out, while allowing the things outside of it from entering, like a semi-permeable box. But spilling out where?</p>\n<p>While the closure itself is a box, any closure will be inside bigger boxes, with the outermost box being the Window object.</p>\n<p><a href=\"https://obedparla.com/static/952aebfcba6f1850f93b3bf6d15392f3/ce2e0/closures_window.jpg\"><img src=\"https://obedparla.com/static/952aebfcba6f1850f93b3bf6d15392f3/ce2e0/closures_window.jpg\" alt=\"A box describing a mental model of a javascript closure, showing Window, scripts and React apps\"></a>The window object encapsulates everything else</p>\n<h3>But What <em>Is</em> A Closure?</h3>\n<p>A closure is a feature of JavaScript functions. If you’re using a function, you’re using a closure.</p>\n<p>As I’ve mentioned, a function is a box and that makes a closure a box too. Considering that each function can contain many others inside of it, then the closure is the ability of a function to use the information outside of it, while keeping the information it has inside from “spilling out”, or being used by the outer function.</p>\n<p>Speaking in terms of my mental model: I imagine the functions as boxes within boxes, and each smaller box can see the information of the outer box, or parent, but the big box cannot see the smaller one’s information. That’s as simple and accurate an explanation of closures as I can make.</p>\n<p><a href=\"https://obedparla.com/static/96f403cd585425c1057214447165bbbe/01d85/data-flow.jpg\"><img src=\"https://obedparla.com/static/96f403cd585425c1057214447165bbbe/7efee/data-flow.jpg\" alt=\"Visual representation of closures and the sharing of information between functions in a mental model, from a box view and a tree view\"></a>Each function can only access its own information and the parent’s</p>\n<p>Closures are important because they can be exploited to create some powerful mechanics and React takes full advantage of this.</p>\n<h3>Closures In React</h3>\n<p>Each React component is also a closure. Within components, you can only pass props down from parent to child and the parent cannot see what’s inside the child, this is an intended feature to make our app’s data flow simpler to trace. To find where data comes from, we usually need to go up the tree to find which parent is sending it down.</p>\n<p>A great example of closures in React is updating a parent’s state through a child component. You’ve probably done this without realizing you were messing around with closures.</p>\n<p>To start, we know the parent can’t access the child’s information directly, but the child can access the parent’s. So we send down that info from parent to child through <code class=\"language-text\">props</code>. In this case, the information takes the shape of a function that updates the parent’s state.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Parent</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      The count is <span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>ChildButtons onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>setCount<span class=\"token punctuation\">}</span> count<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ChildButtons</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> props<span class=\"token punctuation\">.</span><span class=\"token function\">onClick</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      Increase count\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> props<span class=\"token punctuation\">.</span><span class=\"token function\">onClick</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>count <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      Decrease count\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>When an <code class=\"language-text\">onClick</code> happens in a <code class=\"language-text\">button</code>, that will execute the function received from props <code class=\"language-text\">props.onClick</code>, and update the value using <code class=\"language-text\">props.count</code>.</p>\n<p>The insight here lies in the way we’re updating a parent’s state through a child, in this case, the <code class=\"language-text\">props.onClick</code> function. The reason this works is that the function was <em>declared</em> within the <code class=\"language-text\">Parent</code> component’s scope, within its closure, so it will have access to the parent’s information. Once that function is called in a child, it still lives in the same closure.</p>\n<p>This can be hard to grasp, so the way I imagine it is as a “tunnel” between closures. Each has its own scope, but we can create a one-way communication tunnel that connects both.</p>\n<p>Once we understand how closures affect our components, we can take the next big step: React state.</p>\n<h2>Fitting React’s State Into Our Mental Model</h2>\n<p>React’s philosophy is simple: it handles <em>when</em> and <em>how</em> to render elements, and developers control <em>what</em> to render. State is our tool to decide that what.</p>\n<p>When state changes, its component renders and therefore re-executes all the code within. We do this to show new, updated information to the user.</p>\n<p>In my mental model state is like a special property inside the box. It’s independent of everything else that happens within it. It will get a default value on the first render and always be up to date with the latest value.</p>\n<p>Each variable and function is created on every render, which means their values are also brand new. Even if a variable’s value never changes, it is recalculated and reassigned every time. That’s not the case with state, it only changes when there’s a request for it to change via a <code class=\"language-text\">set state</code> event.</p>\n<p><a href=\"https://obedparla.com/static/acd86ef0ea8a3fe610df603769e68ad9/44313/state-in-box.jpg\"><img src=\"https://obedparla.com/static/acd86ef0ea8a3fe610df603769e68ad9/44313/state-in-box.jpg\" alt=\"React component state visualized as a part of a bigger box with props coming in from outside\"></a>State is a special, independent part of the box; with props coming from outside</p>\n<p>State follows a simple rule: Whenever it changes it will re-rendered the component and its children. Props follow the same logic, if a prop changes, the component will re-render, however, we can control state by modifying it, props are more static and usually change as a reaction to a state change.</p>\n<h2>The Rendering Mental Model: Understanding React’s Magic</h2>\n<p>I consider rendering to be React’s most confusing part because a lot of things happen during rendering that sometimes isn’t obvious by looking at the code. That’s why having a clear mental model helps.</p>\n<p>The way I imagine rendering with my imaginary boxes is two-fold: the first render brings the box into existence, that’s when the state is initialized. The second part is when it re-renders, that’s the box being recycled, most of it is brand new but some important elements of it remain namely state.</p>\n<p>On every render, everything inside a component is created, including variables and functions, that’s why we can have variables storing a calculation’s results, since they will be recalculated on every render. It’s also why functions are not reliable as values, due to their reference (the function’s value, per se) being different every render.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Thumbnail</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>withIcon <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">&lt;</span>AmazingIcon <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span>img src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>imgUrl<span class=\"token punctuation\">}</span> alt<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>alt<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The above will give a different result depending on the props the component receives. The reason React <em>must</em> re-render on every prop change is that it wants to keep the user up to date with the latest information.</p>\n<p>However, the state doesn’t change on re-renders, its value is maintained. That’s why the box is “recycled” instead of created brand new every time. Internally, React is keeping track of each box and making sure its state is always consistent. That’s how React knows when to update a component.</p>\n<p><a href=\"https://obedparla.com/static/78de62863da9bd4c40c588c294167031/ea2ac/react-rendering-mental-model.jpg\"><img src=\"https://obedparla.com/static/78de62863da9bd4c40c588c294167031/7efee/react-rendering-mental-model.jpg\" alt=\"Mental model of a React component re-rendering when props change\"></a>When props (or state) changes, a new render happens and the component’s output can change</p>\n<p>By imagining a box being recycled I can understand what’s going on inside of it. For simple components, it’s easy to grasp, but the more complex a component becomes, the more props it receives, the more state it maintains, the more useful a clear mental model becomes.</p>\n<h2>A Complete React Mental Model: Putting It All Together.</h2>\n<p>Now that I’ve explained all the different parts of the puzzle separately, let’s put it all together. Here’s the complete mental model I use for React components, directly translated from how I imagine them into words.</p>\n<p>I imagine a React component as a box that contains all of its information within its walls, including its children, which are more boxes.</p>\n<p>And like a box in the real world, it can have other boxes inside of it and these boxes can, in turn, contain more boxes. That way each box/component must have a single parent, and a parent can have many children.</p>\n<p><a href=\"https://obedparla.com/static/d6c8afaef3597fd26d9174e070be1ce3/ce2e0/react-mental-model-basic.jpg\"><img src=\"https://obedparla.com/static/d6c8afaef3597fd26d9174e070be1ce3/ce2e0/react-mental-model-basic.jpg\" alt=\"Basic representation of a React component as a mental model using boxes\"></a>The basic representation of a React component</p>\n<p>The boxes are semi-permeable, meaning they never leak anything to the outside but can use information from the outside as if it belonged to them. I imagine like this to represent how closures work in JavaScript.</p>\n<p>In React the way to share information between components is called <code class=\"language-text\">props</code>, the same idea applies to function and then it’s called <code class=\"language-text\">arguments</code>, they both work in the same way but with a different syntax.</p>\n<p>Within components, information can only travel <em>down</em> from parents to children. In other words, children can access their parent’s data and state, but not the other way around, and the way we share that information is through <code class=\"language-text\">props</code>.</p>\n<p>I imagine this directional sharing of information as boxes within boxes. With the inner-most box being able to absorb the parent’s data.</p>\n<p><a href=\"https://obedparla.com/static/a3471b4d03d16406ea159b3bc3f3e218/ce2e0/data-sharing-model.jpg\"><img src=\"https://obedparla.com/static/a3471b4d03d16406ea159b3bc3f3e218/ce2e0/data-sharing-model.jpg\" alt=\" React Mental model of data sharing between components visualized as information flowing downward \"></a>Data is shared from parent to child</p>\n<p>The box must first be created though, and this happens on <code class=\"language-text\">render</code>, where the default value is given to <code class=\"language-text\">state</code> and just like with functions, all the code within the component is executed. In my mental model, this is equivalent to the box being <em>created</em>.</p>\n<p>Subsequent renders, or <code class=\"language-text\">re-renders</code>, execute all the code in the component again, recalculating variables, recreating functions, and so on. Everything except for <code class=\"language-text\">state</code> is brand new on each render. State’s value is maintained across renders is updated only through a <code class=\"language-text\">set</code> method.</p>\n<p>In my mental model, I see re-rendering as recycling the box since most of it is recreated, but it’s still the same box due to React keeping track of the component’s state.</p>\n<p>When a box is recycled all the boxes within it, its children, are also recycled. This can happen because the component’s state was modified or a prop changed.</p>\n<p><a href=\"https://obedparla.com/static/267768646d810a0032728d222c3f13a5/ea2ac/react-rendering-mental-model-full.jpg\"><img src=\"https://obedparla.com/static/267768646d810a0032728d222c3f13a5/7efee/react-rendering-mental-model-full.jpg\" alt=\"Mental model of a React component re-rendering when props or state change\"></a>Mental model of a React component re-rendering when props or state change</p>\n<p>Remember that a state or prop changing means the information the user sees is outdated, and React always wants to keep the UI updated so it re-renders the component that must show the new data.</p>\n<p>By using these mental models I feel confident when working with React. They help me visualize what can be a maze of code into a comprehensive mental map. It also demystifies React and brings it to a level I’m much more comfortable with.</p>\n<p>React is not that complex once you start understanding the core principles behind it and create some ways to imagine how your code works.</p>\n<hr>\n<p>I hope this article was useful to you and it was as enjoyable to read as it was to write! I realized that I understand React intuitively and putting that understanding into words was challenging.</p>\n<p>Want to learn more React through visual mental models? <a href=\"https://obedparla.com/code/a-visual-guide-to-react-mental-models-part-2-use-state-use-effect-and-lifecycles/\">Check out part 2</a>, covering <code class=\"language-text\">useState</code>,<code class=\"language-text\">useEffect</code> and a component’s lifecycles. It has even more great illustrations than this one!</p>\n<p>I’m planning a whole series of <strong>visual</strong> guides. Subscribing to my newsletter is the best way to know when they’re out. I only email for new, high-quality articles.</p>","frontmatter":{"title":"React心智模型","date":"2021/05/25 17:48:03","description":"不同的人以不同的方式学习，但是好的心智模型总是有价值的。"}},"previous":{"fields":{"slug":"/git/git-rollback/"},"frontmatter":{"title":"常用Git命令速查（2）- 操作后悔了怎么办？"}},"next":{"fields":{"slug":"/patch-package/"},"frontmatter":{"title":"团队协作项目中优雅的修改三方库"}}},"pageContext":{"id":"5b4bc664-a3ac-5b80-bef8-d07e3c4f74d0","previousPostId":"f9990ed3-84b2-56d0-b445-529e67681066","nextPostId":"8bab4a34-ee8b-5281-af10-e5c1b0de9eb2"}},"staticQueryHashes":["2355076697","2841359383"]}